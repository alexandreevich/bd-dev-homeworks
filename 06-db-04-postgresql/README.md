# Домашнее задание к занятию 4. «PostgreSQL»

## Задача 1

Используя Docker, поднимите инстанс PostgreSQL (версию 13). Данные БД сохраните в volume.

Подключитесь к БД PostgreSQL, используя `psql`.

Воспользуйтесь командой `\?` для вывода подсказки по имеющимся в `psql` управляющим командам.

**Найдите и приведите** управляющие команды для:

- вывода списка БД,
- подключения к БД,
- вывода списка таблиц,
- вывода описания содержимого таблиц,
- выхода из psql.


## Ответ 1
Использовал compose.yml 
```
version: '3.8'

volumes:
  data: {}
  backup: {}

services:
  postgres:
    image: postgres:13
    container_name: psql
    ports:
      - "0.0.0.0:5432:5432"
    volumes:
      - data:/var/lib/postgresql/data
      - ./backup/:/media/postgresql/backup
    environment:
      POSTGRES_USER: "admin"
      POSTGRES_PASSWORD: "admin"
```
<img width="1352" alt="Снимок экрана 2024-03-08 в 11 50 19" src="https://github.com/alexandreevich/bd-dev-homeworks/assets/109306886/ae536a69-a60c-4c57-9160-936da2e485b3">

 Комманды:
 1. \l+ вывода списка БД
 2. \d+ вывод списка таблиц
 3. \d+ nametable вывода описания содержимого таблиц
 4.  \q выхода из psql.
 
 


## Задача 2

Используя `psql`, создайте БД `test_database`.

Изучите [бэкап БД](https://github.com/netology-code/virt-homeworks/tree/virt-11/06-db-04-postgresql/test_data).

Восстановите бэкап БД в `test_database`.

Перейдите в управляющую консоль `psql` внутри контейнера.

Подключитесь к восстановленной БД и проведите операцию ANALYZE для сбора статистики по таблице.

Используя таблицу [pg_stats](https://postgrespro.ru/docs/postgresql/12/view-pg-stats), найдите столбец таблицы `orders` 
с наибольшим средним значением размера элементов в байтах.

**Приведите в ответе** команду, которую вы использовали для вычисления, и полученный результат.


## Ответ 2
Успешное восстановление БД:
![Снимок экрана 2024-03-12 в 19 31 58](https://github.com/alexandreevich/bd-dev-homeworks/assets/109306886/07b5ff32-38ef-447e-96a0-5378b6b96639)

Взаимодействие с БД:

![Снимок экрана 2024-03-12 в 19 33 40](https://github.com/alexandreevich/bd-dev-homeworks/assets/109306886/be6e5c1e-5d86-476e-b04d-51fefe32452f)




## Задача 3

Архитектор и администратор БД выяснили, что ваша таблица orders разрослась до невиданных размеров и
поиск по ней занимает долгое время. Вам как успешному выпускнику курсов DevOps в Нетологии предложили
провести разбиение таблицы на 2: шардировать на orders_1 - price>499 и orders_2 - price<=499.

Предложите SQL-транзакцию для проведения этой операции.

Можно ли было изначально исключить ручное разбиение при проектировании таблицы orders?


## Ответ 3
Операции по разбивке:

![Снимок экрана 2024-03-12 в 19 35 08](https://github.com/alexandreevich/bd-dev-homeworks/assets/109306886/494a4aa9-73dc-4d85-8267-8be023fad04c)

Да, можно было бы использовать заранее шардирование или разделение таблицы.




## Задача 4

Используя утилиту `pg_dump`, создайте бекап БД `test_database`.

Как бы вы доработали бэкап-файл, чтобы добавить уникальность значения столбца `title` для таблиц `test_database`?



## Ответ 4

Скриншот операций:

![Снимок экрана 2024-03-12 в 19 36 52](https://github.com/alexandreevich/bd-dev-homeworks/assets/109306886/bd9f5078-45be-4832-b204-a01c58aaf7f2)

Можно добавить ограничение уникальности для столбца title, указав имя ограничения UNIQUE.

---

### Как cдавать задание

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---

